<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Generator ‚Äì KatoKits</title>
  <meta name="description" content="Build custom preschool lesson plans in seconds! Use the KatoKits AI activity generator for personalized, playful, and curriculum-aligned ideas.">
  <link rel="stylesheet" href="styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
  <script src="js/auth-api.js"></script>
  <style>
    .ai-gen-form {
      max-width: 400px;
      margin: 1rem auto;
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow-card);
      padding: 1.2rem;
      text-align: center;
    }
    .ai-gen-form label {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--green);
      display: block;
      margin-bottom: 0.3rem;
      text-align: left;
    }
    .ai-gen-form input, .ai-gen-form select {
      margin-bottom: 0.8rem;
      padding: 0.5rem;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      font-size: 0.8rem;
      width: 100%;
      box-sizing: border-box;
      font-family: 'Nunito', Arial, sans-serif;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .ai-gen-form input:focus, .ai-gen-form select:focus {
      outline: none;
      border-color: var(--green);
      box-shadow: 0 0 0 2px rgba(80, 128, 94, 0.1);
    }
    .ai-gen-form .btn {
      margin-top: 0.3rem;
      padding: 0.6rem 1.5rem;
      font-size: 0.85rem;
    }
    .ai-output {
      margin-top: 1rem;
      background: linear-gradient(135deg, var(--cream-left), #f0f9f4);
      border-radius: 0.8rem;
      padding: 1rem;
      color: var(--green);
      box-shadow: 0 2px 8px rgba(80, 128, 94, 0.1);
      font-size: 0.85rem;
      line-height: 1.5;
      border-left: 3px solid var(--peach);
    }
  </style>
</head>
<body>
<header>
  <div class="logo">KatoKits</div>
  <nav>
    <a href="index.html">Home</a>
    <a href="lesson-plans.html">Lesson Plans</a>
    <a href="ai.html" class="active">AI Generator</a>
    <a href="freebies.html">Freebies</a>
    <a href="pricing.html">Shop</a>
    <a href="about.html">About</a>
    <a href="contact.html">Contact</a>
  </nav>
</header>

<section class="hero">
  <h1>ü§ñ AI Lesson Plan Generator</h1>
  <p>Build custom, developmentally-appropriate activities for infants through kindergarten!</p>
  
  <!-- Clean Pricing Grid -->
  <div class="grid" style="margin: 2rem 0;">
    <!-- Basic Plan -->
    <div class="card" style="text-align: center; position: relative;">
      <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">‚≠ê</div>
      <h3 style="color: #6b7280;">Basic Plan</h3>
      <div style="font-size: 2rem; font-weight: 900; color: #6b7280; margin: 0.5rem 0;">$9.99</div>
      <p style="color: #6b7280; font-size: 0.9rem; margin-bottom: 1rem;">CAD per month</p>
      <ul style="text-align: left; color: #6b7280; font-size: 0.9rem; margin: 0 0 1.5rem 0; padding-left: 1rem; line-height: 1.6;">
        <li>10 AI lesson plans/month</li>
        <li>Basic templates</li>
        <li>Email support</li>
        <li>Perfect for home use</li>
      </ul>
      <a href="pricing.html" class="btn" style="width: 100%; box-sizing: border-box;">Choose Basic</a>
    </div>
    
    <!-- Unlimited Plan -->
    <div class="card" style="text-align: center; position: relative; border: 2px solid var(--peach); transform: scale(1.05);">
      <div style="position: absolute; top: -0.5rem; left: 50%; transform: translateX(-50%); background: var(--peach); color: white; padding: 0.3rem 1rem; border-radius: 1rem; font-size: 0.75rem; font-weight: 700;">Most Popular</div>
      <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üöÄ</div>
      <h3 style="color: var(--peach);">Unlimited Plan</h3>
      <div style="font-size: 2rem; font-weight: 900; color: var(--peach); margin: 0.5rem 0;">$19.99</div>
      <p style="color: var(--peach); font-size: 0.9rem; margin-bottom: 1rem;">CAD per month</p>
      <ul style="text-align: left; color: #92400e; font-size: 0.9rem; margin: 0 0 1.5rem 0; padding-left: 1rem; line-height: 1.6;">
        <li>Unlimited AI lesson plans</li>
        <li>All printable activity sheets</li>
        <li>Priority support</li>
        <li>Perfect for teachers & homes</li>
      </ul>
      <a href="pricing.html" class="btn" style="width: 100%; box-sizing: border-box;">Choose Unlimited</a>
    </div>
    
    <!-- Professional Plan -->
    <div class="card" style="text-align: center; position: relative; border: 2px solid #8b5cf6;">
      <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üè´</div>
      <h3 style="color: #7c3aed;">Professional Plan</h3>
      <div style="font-size: 2rem; font-weight: 900; color: #7c3aed; margin: 0.5rem 0;">$79.99</div>
      <p style="color: #7c3aed; font-size: 0.9rem; margin-bottom: 1rem;">CAD per month</p>
      <ul style="text-align: left; color: #6d28d9; font-size: 0.9rem; margin: 0 0 1.5rem 0; padding-left: 1rem; line-height: 1.6;">
        <li>Unlimited AI plans</li>
        <li>Multi-user access</li>
        <li>Phone support</li>
        <li>Perfect for daycares & centers</li>
      </ul>
      <a href="pricing.html" class="btn" style="width: 100%; box-sizing: border-box;">Choose Professional</a>
    </div>
  </div>
  
  <div style="text-align: center; margin-top: 1rem;">
    <a href="freebies.html" style="color: var(--green); text-decoration: underline; font-weight: 600; font-size: 0.9rem;">Or try free activities first</a>
  </div>
</section>

<section>
  <form class="ai-gen-form">
    <label for="theme">Pick a theme:</label>
    <select id="theme" name="theme" required>
      <option value="">-- Select Theme --</option>
      <option>Animals & Pets</option>
      <option>Weather & Seasons</option>
      <option>Transportation</option>
      <option>Community Helpers</option>
      <option>Feelings & Social-Emotional</option>
      <option>Bugs & Nature</option>
      <option>All About Me & Family</option>
      <option>Colors & Shapes</option>
      <option>Food & Nutrition</option>
      <option>Holidays & Celebrations</option>
      <option>Ocean & Sea Life</option>
      <option>Space & Planets</option>
      <option>Plants & Gardens</option>
      <option>Music & Movement</option>
      <option>Art & Creativity</option>
      <option>Books & Stories</option>
      <option>Safety & Health</option>
      <option>Custom Theme</option>
    </select>
    <label for="age">Child's Age:</label>
    <select id="age" name="age" required>
      <option value="">-- Select Age Range --</option>
      <option>6-12 months (Infant)</option>
      <option>12-18 months (Young Toddler)</option>
      <option>18-24 months (Toddler)</option>
      <option>2-3 years (Older Toddler)</option>
      <option>3-4 years (Preschool)</option>
      <option>4-5 years (Pre-K)</option>
      <option>5-6 years (Kindergarten)</option>
    </select>
    <label for="domain">Developmental Domain:</label>
    <select id="domain" name="domain" required>
      <option value="">-- Select Domain --</option>
      <option>Physical Development (Gross Motor)</option>
      <option>Physical Development (Fine Motor)</option>
      <option>Cognitive Development</option>
      <option>Language & Communication</option>
      <option>Social-Emotional Development</option>
      <option>Creative Arts & Expression</option>
      <option>Math & Early Numeracy</option>
      <option>Science & Discovery</option>
      <option>Literacy & Pre-Reading</option>
      <option>Self-Help & Independence</option>
      <option>Sensory Development</option>
      <option>Multi-Domain (Integrated)</option>
    </select>
    <label for="goal">Specific Learning Goal (optional):</label>
    <input type="text" id="goal" name="goal" placeholder="e.g. counting 1-5, expressing emotions, building with blocks">
    <label for="setting">Learning Environment:</label>
    <select id="setting" name="setting">
      <option value="">-- Select Setting --</option>
      <option>Home/Family Setting</option>
      <option>Daycare Center</option>
      <option>Preschool Classroom</option>
      <option>Outdoor/Nature</option>
      <option>Small Group (2-4 children)</option>
      <option>Large Group (5+ children)</option>
      <option>One-on-One</option>
    </select>
    <button type="submit" class="btn">Generate Plan</button>
    <div class="ai-output" style="display:none;">
      <!-- AI result will appear here -->
    </div>
  </form>
</section>

<!-- Activity Packages Section -->
<section class="section">
  <h2>üõçÔ∏è Printable Preschool Activities</h2>
  <p style="text-align: center; margin-bottom: 2rem; color: var(--green);">Instant downloads. Easy instructions. Joyful learning.</p>
  
  <div class="grid">
    <!-- Animal Adventures Package -->
    <div class="card">
      <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ü¶Å</div>
      <h3>Animal Adventures</h3>
      <p>15 activities exploring farm animals, zoo animals, and pets through games, art, and sensory play.</p>
      <div style="font-size: 1.5rem; font-weight: 700; color: var(--green); margin: 1rem 0;">$12.99 CAD</div>
      <ul style="text-align: left; font-size: 0.9rem; color: #6b7280; margin-bottom: 1rem;">
        <li>PDF & Google Slides formats</li>
        <li>Ages 18 months - 5 years</li>
        <li>Printable activity sheets</li>
      </ul>
      <a href="pricing.html" class="btn">Get Package</a>
    </div>

    <!-- Weather & Seasons Package -->
    <div class="card">
      <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üå¶Ô∏è</div>
      <h3>Weather & Seasons</h3>
      <p>12 activities exploring weather patterns, seasonal changes, and nature observations.</p>
      <div style="font-size: 1.5rem; font-weight: 700; color: var(--green); margin: 1rem 0;">$10.99 CAD</div>
      <ul style="text-align: left; font-size: 0.9rem; color: #6b7280; margin-bottom: 1rem;">
        <li>PDF & Google Slides formats</li>
        <li>Ages 2-6 years</li>
        <li>Weather tracking charts</li>
      </ul>
      <a href="pricing.html" class="btn">Get Package</a>
    </div>

    <!-- Transportation Package -->
    <div class="card">
      <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üöó</div>
      <h3>Transportation Fun</h3>
      <p>10 activities about cars, trains, boats, and planes with sorting, counting, and dramatic play.</p>
      <div style="font-size: 1.5rem; font-weight: 700; color: var(--green); margin: 1rem 0;">$9.99 CAD</div>
      <ul style="text-align: left; font-size: 0.9rem; color: #6b7280; margin-bottom: 1rem;">
        <li>PDF & Google Slides formats</li>
        <li>Ages 18 months - 4 years</li>
        <li>Vehicle matching games</li>
      </ul>
      <a href="pricing.html" class="btn">Get Package</a>
    </div>

    <!-- Community Helpers Package -->
    <div class="card">
      <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üë©‚Äçüöí</div>
      <h3>Community Helpers</h3>
      <p>14 activities about firefighters, doctors, teachers, and other helpers in our community.</p>
      <div style="font-size: 1.5rem; font-weight: 700; color: var(--green); margin: 1rem 0;">$11.99 CAD</div>
      <ul style="text-align: left; font-size: 0.9rem; color: #6b7280; margin-bottom: 1rem;">
        <li>PDF & Google Slides formats</li>
        <li>Ages 3-6 years</li>
        <li>Role-play activity cards</li>
      </ul>
      <a href="pricing.html" class="btn">Get Package</a>
    </div>

    <!-- Emotions & Feelings Package -->
    <div class="card">
      <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üòä</div>
      <h3>Emotions & Feelings</h3>
      <p>8 social-emotional activities to help children identify and express their feelings.</p>
      <div style="font-size: 1.5rem; font-weight: 700; color: var(--green); margin: 1rem 0;">$8.99 CAD</div>
      <ul style="text-align: left; font-size: 0.9rem; color: #6b7280; margin-bottom: 1rem;">
        <li>PDF & Google Slides formats</li>
        <li>Ages 2-5 years</li>
        <li>Emotion identification cards</li>
      </ul>
      <a href="pricing.html" class="btn">Get Package</a>
    </div>

    <!-- Ocean & Sea Life Package -->
    <div class="card">
      <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üê†</div>
      <h3>Ocean & Sea Life</h3>
      <p>13 underwater adventures with sea creatures, ocean sounds, and water play activities.</p>
      <div style="font-size: 1.5rem; font-weight: 700; color: var(--green); margin: 1rem 0;">$11.99 CAD</div>
      <ul style="text-align: left; font-size: 0.9rem; color: #6b7280; margin-bottom: 1rem;">
        <li>PDF & Google Slides formats</li>
        <li>Ages 18 months - 5 years</li>
        <li>Ocean animal fact cards</li>
      </ul>
      <a href="pricing.html" class="btn">Get Package</a>
    </div>
  </div>

  <div style="text-align: center; margin-top: 2rem;">
    <a href="pricing.html" class="btn">View All Packages</a>
  </div>
</section>

<!-- Newsletter Section - matching home page -->
<section class="newsletter-section">
  <h2>üéÅ Try our classroom-tested activities for ages 6 months to kindergarten, absolutely free.</h2>
  <p>Download, print, and play‚Äîno signup needed!</p>
  <form>
    <input type="email" name="EMAIL" placeholder="Email address" required>
    <button type="submit" class="btn">Get 3 Free AI Plans</button>
  </form>
</section>

<footer>
  <div class="footer-content">
    <p>¬© 2025 KatoKits. All rights reserved.</p>
    <div class="footer-info">
      <p><strong>Support Hours:</strong> Monday-Friday, 9 AM - 5 PM EST</p>
      <p><strong>Need Quick Help?</strong> Follow us on <a href="https://www.instagram.com/katokitsdigital/" target="_blank" style="color: var(--green); text-decoration: underline;">Instagram @katokitsdigital</a> üì±</p>
    </div>
  </div>
</footer>

<script>
// --- Mobile Menu Toggle ---
function toggleMobileMenu() {
  const navLinks = document.getElementById('navLinks');
  navLinks.classList.toggle('mobile-open');
}

// --- AI Access Control (Updated for Backend) ---
function showAIForm() {
  document.querySelector('.ai-gen-form').style.display = 'block';
  const lockedDiv = document.getElementById('ai-locked');
  if (lockedDiv) lockedDiv.style.display = 'none';
}

function showLocked() {
  document.querySelector('.ai-gen-form').style.display = 'none';
  let lockedDiv = document.getElementById('ai-locked');
  if (!lockedDiv) {
    // Create locked message if it doesn't exist
    lockedDiv = document.createElement('div');
    lockedDiv.id = 'ai-locked';
    lockedDiv.innerHTML = `
      <div class="card" style="max-width: 600px; margin: 2rem auto; text-align: center;">
        <h3 style="color: var(--green); margin-bottom: 1rem;">üîí Premium Access Required</h3>
        <p style="margin-bottom: 2rem;">Choose a plan to unlock unlimited AI lesson planning:</p>
        
        <div class="grid" style="margin-bottom: 2rem;">
          <div class="card" style="border: 2px solid #e5e7eb;">
            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">‚≠ê</div>
            <h4>Basic Plan</h4>
            <div style="font-size: 1.5rem; font-weight: 900; color: #6b7280;">$9.99 CAD/month</div>
          </div>
          <div class="card" style="border: 2px solid var(--peach);">
            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üöÄ</div>
            <h4>Unlimited Plan</h4>
            <div style="font-size: 1.5rem; font-weight: 900; color: var(--peach);">$19.99 CAD/month</div>
          </div>
          <div class="card" style="border: 2px solid #8b5cf6;">
            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üè´</div>
            <h4>Professional Plan</h4>
            <div style="font-size: 1.5rem; font-weight: 900; color: #7c3aed;">$79.99 CAD/month</div>
          </div>
        </div>
        
        <a href="pricing.html" class="btn" style="margin-right: 1rem;">Choose Your Plan</a>
        <a href="freebies.html" style="color: var(--green); text-decoration: underline;">Try free activities first</a>
      </div>
    `;
    document.querySelector('section.hero').appendChild(lockedDiv);
  }
  lockedDiv.style.display = 'block';
}

// --- Initialize Page ---
document.addEventListener('DOMContentLoaded', async function() {
  // Update auth buttons
  katoAPI.updateAuthButtons();
  
  try {
    if (katoAPI.isAuthenticated()) {
      // Check user's AI usage
      const usage = await katoAPI.getAIUsage();
      
      if (usage.can_generate) {
        showAIForm();
        // Update button text to show remaining uses
        const button = document.querySelector('.ai-gen-form .btn');
        if (usage.subscription_plan === 'free' && usage.free_trial_uses > 0) {
          button.textContent = `Generate Plan (${usage.free_trial_uses} free left)`;
        } else if (usage.subscription_plan !== 'free') {
          button.textContent = 'Generate Plan';
        }
      } else {
        showLocked();
      }
    } else {
      // For non-authenticated users, show form but check on submission
      showAIForm();
      const button = document.querySelector('.ai-gen-form .btn');
      button.textContent = 'Generate Plan (Sign up for 3 free)';
    }
  } catch (error) {
    console.error('Error checking AI usage:', error);
    showAIForm(); // Default to showing form
  }
});

// --- AI Generation Form Handler ---
document.addEventListener('DOMContentLoaded', function() {
  document.querySelector('.ai-gen-form').onsubmit = async function(e) {
    e.preventDefault();
    
    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    
    try {
      submitBtn.disabled = true;
      submitBtn.textContent = 'Generating...';
      
      // Check if user can generate
      if (!katoAPI.isAuthenticated()) {
        // Prompt for signup or email
        const email = prompt('Enter your email to get 3 free AI lesson plans:');
        if (!email) {
          return;
        }
        
        try {
          await katoAPI.captureEmail(email);
        } catch (error) {
          alert(`Failed to capture email: ${error.message}`);
          return;
        }
      }
      
      // Record AI usage first
      const email = katoAPI.isAuthenticated() ? null : prompt('Enter your email:');
      await katoAPI.recordAIUsage(email);
      
      // Get form data
      const age = document.getElementById('age').value;
      const domain = document.getElementById('domain').value;
      const theme = document.getElementById('theme').value;
      const setting = document.getElementById('setting').value;
      
      // Create prompt
      const prompt = `Create a preschool lesson plan for ${age} children focusing on ${domain} learning. Theme: ${theme}. Setting: ${setting}.`;
      
      // Call AI generation API
      const response = await fetch('/.netlify/functions/generateAIPlan', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          ...(katoAPI.authToken ? { 'Authorization': `Bearer ${katoAPI.authToken}` } : {})
        },
        body: JSON.stringify({ 
          prompt, 
          email: katoAPI.isAuthenticated() ? null : email 
        })
      });
      
      const data = await response.json();
      
      if (!response.ok) {
        throw new Error(data.error || 'Generation failed');
      }
      
      // Display result
      const output = document.querySelector('.ai-output');
      output.style.display = 'block';
      output.innerHTML = `
        <div style="background: white; padding: 1.5rem; border-radius: 8px; margin-top: 1rem;">
          <h3 style="color: var(--green); margin-bottom: 1rem;">üéØ Your Custom Lesson Plan</h3>
          <div style="white-space: pre-wrap; line-height: 1.6;">${data.plan}</div>
        </div>
      `;
      
      // Check if user has exceeded free limit
      if (data.error && data.upgrade_required) {
        showLocked();
      }
      
    } catch (error) {
      console.error('AI generation error:', error);
      
      if (error.message.includes('Free trial limit reached')) {
        alert('You\'ve used all your free AI generations. Please upgrade to continue.');
        showLocked();
      } else {
        alert(`AI generation failed: ${error.message}`);
        
        // Show sample content as fallback
        const age = document.getElementById('age').value;
        let sampleActivity = '';
        if (age.includes('6-12 months')) {
          sampleActivity = 'üçº <b>Infant Sensory Play:</b><br>Provide soft fabric squares in different textures for baby to explore with hands and mouth. Narrate what they\'re feeling: "This is bumpy! This is smooth!" Perfect for sensory development and early language exposure.';
        } else if (age.includes('2-3 years')) {
          sampleActivity = 'üé® <b>Process Art Creation:</b><br>Set up finger painting with just 2 colors. Let toddlers explore mixing and making marks. Focus on the process, not the product. Great for creativity and fine motor development!';
        } else if (age.includes('3-4 years')) {
          sampleActivity = 'üå± <b>Dramatic Play Garden:</b><br>Create a pretend garden with play vegetables, watering cans, and gardening tools. Children can "plant," "water," and "harvest." Builds language, social skills, and science concepts!';
        } else if (age.includes('4-5 years')) {
          sampleActivity = 'üìä <b>Weather Graphing:</b><br>Track daily weather on a simple graph for a week. Children can draw symbols and count sunny vs. rainy days. Combines math, science, and data analysis skills!';
        } else {
          sampleActivity = 'üåü <b>Multi-Age Activity:</b><br>Set up a sensory bin with rice and hidden toys. Younger children explore textures while older ones can sort, count, or create stories with the objects they find!';
        }
        
        const output = document.querySelector('.ai-output');
        output.style.display = 'block';
        output.innerHTML = sampleActivity + '<br><br><small>üí° This is a sample activity. Please try again or upgrade for full AI generation!</small>';
      }
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = originalText;
    }
  };
});
</script>
</body>
</html>
